alert:
- debug
description: Detects the creation of the "PSScriptPolicyTest" PowerShell script by
  an uncommon process. This file is usually generated by Microsoft Powershell to test
  against Applocker.
filter:
- query:
    query_string:
      query: (file_name.keyword:*__PSScriptPolicyTest_* AND (NOT ((process_path.keyword:(*\:\\Program\
        Files\\PowerShell\\7\-preview\\pwsh.exe OR *\:\\Program\ Files\\PowerShell\\7\\pwsh.exe
        OR *\:\\Windows\\System32\\dsac.exe OR *\:\\Windows\\System32\\sdiagnhost.exe
        OR *\:\\Windows\\System32\\ServerManager.exe OR *\:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell_ise.exe
        OR *\:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe OR *\:\\Windows\\System32\\wsmprovhost.exe
        OR *\:\\Windows\\SysWOW64\\sdiagnhost.exe OR *\:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell_ise.exe
        OR *\:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe)))))
index: wazuh-alerts*
name: file_event_win_ps_script_policy_test_creation_by_uncommon_process
priority: 3
realert:
  minutes: 0
type: any

is_enabled: true
timestamp_type: iso
timestamp_field: '@timestamp'
